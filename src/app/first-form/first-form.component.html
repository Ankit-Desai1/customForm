
<div fxLayout="row">
    <div fxFlex="60%">
        <form [formGroup]="firstForm" (ngSubmit)="submit()">
            <mat-form-field appearance="fill">
                <mat-label>Assesment Template</mat-label>
                <input matInput placeholder="Assesment Name" [formControl]="name" required>
                <mat-error *ngIf="name.hasError('required')">Name is required</mat-error>
            </mat-form-field>
        
            <mat-form-field appearance="fill">
                <mat-label>Body Region</mat-label>
                <mat-select [formControl]="bodyRegion">
                    <mat-option value="primary">Primary</mat-option> 
                </mat-select>
                <mat-error *ngIf="bodyRegion.hasError('required')">Please select an option</mat-error>
            </mat-form-field>
        
            <div>
                <mat-form-field appearance="fill">
                    <mat-label>Description</mat-label>
                    <textarea matInput placeholder="Please enter a description here(max. 250 words)" [formControl]="description" required></textarea>
                    <mat-error *ngIf="description.hasError('required')">Description is required</mat-error>
                </mat-form-field>
            </div>
        </form>
    </div>

    <div >
        <p>patient measurement</p>
        <mat-card class="example-card">
            <mat-card-content>
                <form [formGroup]="measurementForm">
                    <div formArrayName="measurementArray">
                        <tr *ngFor="let number of measurementForm.controls['measurementArray']['controls']; let i=index" [formGroupName]="i" fxLayoutGap="20px">
                            <mat-form-field appearance="fill" fxFlex="45%">
                                <input matInput [formControl]="timePeriod" required>
                                <mat-error *ngIf="timePeriod.hasError('required')">time period is required</mat-error>
                            </mat-form-field>
                            <mat-form-field appearance="fill" fxFlex="45%">
                                <input matInput [formControl]="time" required [ngxMatTimepicker]="picker">
                                <mat-error *ngIf="time.hasError('required')">time is Requires</mat-error>
                            </mat-form-field>
                            <ngx-mat-timepicker #picker></ngx-mat-timepicker>
                        </tr>
                    </div>
                </form>

                <button mat-raised-button color="primary" (click)="addNewMeasurement()">Add Schedule+</button>
            </mat-card-content>
          </mat-card>
    </div>
</div>


<div fxLayout="row" class="details">
    <div fxFlex="20%" class="categoryForm" >
        <p>Category</p>
        <tr *ngFor="let name of categoryArray" >
            <mat-slide-toggle checked="true">
                    {{name}} 
            </mat-slide-toggle>
        </tr>
        <form [formGroup]="categoryForm" *ngIf="isCategoryFormVisible" class="categoryInput" >
            <mat-slide-toggle checked="true">
                <mat-form-field appearance="outline">
                    <input matInput [formControl]="categoryName" required >
                    <mat-error *ngIf="categoryName.hasError('require')">Category name is required</mat-error>
                </mat-form-field>
            </mat-slide-toggle>
        </form>
        <div fxLayoutAlign="center center">
            <button mat-fab color="warn" (click)="addInCategory()">
                <mat-icon>+</mat-icon>
            </button>
        </div>
    </div>
    <div fxFlex="20%"(click)="inAssesment()" class="assesmentForm">
        <p>Assesment</p>
        <tr *ngFor="let name of assesmentArray">
            <mat-slide-toggle checked="true">        
                    {{name}}
            </mat-slide-toggle>
        </tr>
        <form [formGroup]="assesmentForm" *ngIf="isAssesmentFormVisible" class="assesmentInput" >
            <mat-slide-toggle checked="true">
                <mat-form-field appearance="outline">
                    <input matInput [formControl]="assesmentName" required>
                </mat-form-field>
            </mat-slide-toggle>
        </form>
        <div fxLayoutAlign="center center">
            <button mat-fab color="warn" (click)="addInAssesment()">
                <mat-icon>+</mat-icon>
            </button>
        </div>
    </div>
    <div fxFlex="60%" (click)="inAssesmentDetail()">
        <p>Assesment details</p>
        <div *ngIf="isAssesmentDetailFormVisible">
            <form [formGroup]="assesmentDetailsForm" >
            <div fxLayout="row">
                <p fxFlex="25%">type</p>
                <mat-form-field appearance="outline" fxFlex="45%">
                    <mat-select [formControl]="assesmentDetailsType" required (valueChange)="changeAssesmentType($event)" placeholder="--Please select--">
                        <mat-option *ngFor="let type of assesmentDetailsTypeArray" value={{type.value}} >{{type.name}}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div>
                <p fxFlex="25%">Unit</p>
                <mat-form-field appearance="fill" fxFlex="45%">
                    <mat-select [formControl]="assesmentDetailsUnit" required (valueChange)="changeAssesmentUnit($event)" [(ngModel)]="getUnitOfAssesmentType[0].type" >
                        <mat-option *ngFor="let type of getUnitOfAssesmentType" value={{type.type}} >{{type.type}}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
        <div>
                <p fxFlex="25%">Value Range</p>
                <div fxFlex="45%">

                    <mat-form-field appearance="fill" >
                        <input matInput [formControl]="assesmentDetailsRangeFrom"  required>
                        <mat-error *ngIf="assesmentDetailsRangeTo.hasError('required')">is required</mat-error>
                        <mat-error *ngIf="assesmentDetailsRangeTo.hasError('max')">max 360</mat-error>
                    </mat-form-field>
                    <p>to</p>
                    <mat-form-field appearance="fill">
                        <input matInput [formControl]="assesmentDetailsRangeTo"  required>
                        <mat-error *ngIf="assesmentDetailsRangeTo.hasError('required') || assesmentDetailsRangeTo.hasError('max')  || assesmentDetailsRangeTo.hasError('min') ">Please select value between 1 and {{valueOfRange}}</mat-error>
                        <mat-error *ngIf="assesmentDetailsRangeTo.touched">{{validationOfRange()}}</mat-error>
                    </mat-form-field>
                </div>
            </div>
        <div>
                <p fxFlex="25%">Measurement Type</p>
                <mat-slide-toggle (change)="sideComparison($event)" >Side Comparison</mat-slide-toggle>
            </div>
            <div>
                <p fxFlex="25%">Measuring Region</p>
                <mat-form-field appearance="fill" fxFlex="45%">
                    <textarea matInput [formControl]="assesmentDetailsMeasuringRegion" required placeholder=" e.g Body region(Right)" ></textarea>
                    <mat-error *ngIf="assesmentDetailsMeasuringRegion.hasError('required')">Measuring region is required </mat-error>
                </mat-form-field> 
            </div>
            <div *ngIf="isReferenceRegionVisible">
                <p fxFlex="25%">Reference Region</p>
                <mat-form-field appearance="fill" fxFlex="45%">
                    <textarea matInput [formControl]="assesmentDetailsReferenceRegion" required placeholder=" e.g Body region(Left)" ></textarea>
                </mat-form-field> 
            </div>
            <div>
                <p fxFlex="25%">Measurements</p>
                <mat-form-field appearance="fill" fxFlex="45%">
                    <mat-select [formControl]="bodyRegion" multiple [(ngModel)]="measurementDefault" (valueChange)="selectMeasurement($event)">
                        <mat-option *ngFor="let type of getMeasurements" [value]="type.value" >{{type.name}}</mat-option>
                    </mat-select>
                </mat-form-field> 
            </div>
            <div fxLayout="">
                <p fxFlex="25%">Goals</p>
                <div fxFlex="70%">
                <div *ngIf="isSimpleVisible"   fxLayoutGap="10px">
                    <mat-form-field appearance="fill" fxFlex="40%">
                        <mat-select [formControl]="typeOfSimple" (valueChange)="changeInSimple($event)" [ngModel]="valueComparisonArray[0].value" >
                            <mat-option *ngFor="let type of valueComparisonArray" [value]="type.value">{{type.name}}</mat-option>
                        </mat-select>
                    </mat-form-field>
        
                    <mat-form-field appearance="fill" fxFlex="20%">
                        <input matInput [formControl]="valueOfSimple" required (change)="simpleChange($event)" >
                    </mat-form-field>
                    
                    <span *ngIf="isSecondInputSimpleVisible" class="inputField" fxFlex="30%">
                        <span fxFlex="30%">and</span>
                        <mat-form-field appearance="fill" fxFlex="70%">
                            <input matInput [formControl]="secondValueOfSimple" required>
                        </mat-form-field>
                    </span>
                    <span fxFlex="10%">{{Unit}}</span>
                </div>
                <div *ngIf="isErrorVisible" fxLayoutGap="10px">
                    <mat-form-field appearance="fill" fxFlex="40%" >
                        <mat-select [formControl]="typeOfError" (valueChange)="changeInError($event)" [ngModel]="valueComparisonArray[0].value">
                            <mat-option *ngFor="let type of valueComparisonArray" [value]="type.value">{{type.name}}</mat-option>
                        </mat-select>
                    </mat-form-field>
        
                    <mat-form-field appearance="fill" fxFlex="20%" >
                        <input matInput [formControl]="valueOfError" required (change)="errorChange($event)">
                    </mat-form-field>

                    <div *ngIf="isSecondInputErrorVisible" fxFlex="30%" >
                        <span fxFlex="30%" >and</span>
                        <mat-form-field appearance="fill" fxFlex="70%" >
                            <input matInput [formControl]="secondValueOfError" required>
                        </mat-form-field>
                    </div>
                    <p fxFlex="10%" >%Error rate</p>
                </div>
                <div *ngIf="isDifferenceVisible"  fxLayoutGap="10px">
                    <mat-form-field appearance="fill" fxFlex="40%" >
                        <mat-select [formControl]="typeOfDifference" (valueChange)="changeInDifference($event)" [ngModel]="valueComparisonArray[0].value">
                            <mat-option *ngFor="let type of valueComparisonArray" [value]="type.value">{{type.name}}</mat-option>
                        </mat-select>
                    </mat-form-field>
        
                    <mat-form-field appearance="fill" fxFlex="20%" >
                        <input matInput [formControl]="valueOfDifference" required (change)="differenceChange($event)">
                    </mat-form-field>

                    <div *ngIf="isSecondInputDifferenceVisible" fxFlex="30%" >
                        <span fxFlex="30%" >and</span>
                        <mat-form-field appearance="fill" fxFlex="70%" >
                            <input matInput [formControl]="secondValueOfDifference" required>
                        </mat-form-field>
                    </div>
                    <p fxFlex="10%" >{{Unit}} (Difference to reference region)</p>
                </div >
                <div *ngIf="isComparisonVisible" fxLayoutGap="10px">
                    <mat-form-field appearance="fill" fxFlex="40%" >
                        <mat-select [formControl]="typeOfComparison" (valueChange)="changeInComparison($event)" [ngModel]="valueComparisonArray[0].value">
                            <mat-option *ngFor="let type of valueComparisonArray" [value]="type.value">{{type.name}}</mat-option>
                        </mat-select>
                    </mat-form-field>
        
                    <mat-form-field appearance="fill" fxFlex="20%" >
                        <input matInput [formControl]="valueOfComparison" required (change)="comparisonChange($event)">
                    </mat-form-field>

                    <div *ngIf="isSecondInputComparisonVisible" fxFlex="30%" >
                        <span fxFlex="30%" >and</span>
                        <mat-form-field appearance="fill" fxFlex="70%" >
                            <input matInput [formControl]="secondValueOfComparison" required>
                        </mat-form-field>
                    </div>
                    <p fxFlex="10%" >% of the reference region</p>
                </div>
            </div>
            </div>
            <div>
                <p fxFlex="25%">Description</p>
                <mat-form-field appearance="fill" fxFlex="45%">
                    <textarea matInput [formControl]="assesmentDetailsDescription" required></textarea>
                </mat-form-field> 
            </div>
            <div>
                <p fxFlex="25%">Routine</p>
                <div fxFlex="45%">
                    <mat-form-field appearance="fill">
                        <mat-select [formControl]="assesmentDetailsRoutine" placeholder="please select" (valueChange)="routineChange($event)" >
                            <mat-option *ngFor="let type of routineArray" [value]="type.value" >{{type.name}}</mat-option>
                        </mat-select>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <mat-select [formControl]="assesmentDetailsRoutineDays" [(ngModel)]="selectedDays" multiple placeholder="None">
                            <mat-option *ngFor="let type of week" [value]="type" >{{type}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
            <div>
                <p fxFlex="25%">times</p>
                <mat-form-field appearance="fill" fxFlex="45%">
                    <mat-select [formControl]="assesmentDetailsTime" placeholder="None" multiple>
                        <mat-option *ngFor="let type of timeArray" [value]="type.timePeriod" >{{type.timePeriod}}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
        </form>
    </div>
    <div><canvas #graph style="height:20vh; width:40vw"></canvas></div>
    </div>
</div>